<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/polymerfire/firebase-query.html">
<link rel="import" href="../../bower_components/paper-toolbar/paper-toolbar.html">
<link rel="import" href="../../bower_components/app-storage/app-indexeddb-mirror/app-indexeddb-mirror.html">
<link rel="import" href="../../bower_components/paper-fab/paper-fab.html">
<link rel="import" href="../../bower_components/iron-icons/iron-icons.html">
<link rel="import" href="../../bower_components/paper-item/paper-item.html">
<link rel="import" href="../../tgc-ing-transaction-icons.html">

<dom-module id="off-scrum-day-app">
    <template>
        <style>
            :host {
                display: block;

            }

            iron-icon {
                --iron-icon-fill-color: #FF6200;
                margin-right: 12px;
                margin-bottom: 3px;
            }

            paper-toolbar.ingtoolbar {
                --paper-toolbar-background: #FF6200;
            }

            .unviewed {
                font-style: italic;
                font-weight: bold;
            }
            .viewed {
                font-style: normal;
                font-weight: normal;
            }

            .ing {
                display: inline-flex;
            }

            .ingamount {
                display: inline-flex;
                position: absolute;
                right: 10px;
                top:10px;

            }

            paper-item {
                margin: 10px;
                padding: 5px;
            }

            .seperateline {
                display: inline-flex;
                margin: 3px;

            }

        </style>

        <firebase-query id="query" app-name="offscrumday" path="/offscrumday" data="{{data}}"></firebase-query>
        <app-indexeddb-mirror session="user1" key="offscrumday" data="{{data}}"
                              persisted-data="{{persistedData}}"></app-indexeddb-mirror>
        <paper-toolbar class="ingtoolbar">
            <div class="title">ING</div>
            <paper-fab icon="add" on-tap="mimicTransaction">Mimic transaction</paper-fab>
        </paper-toolbar>

            <template is="dom-repeat" items="[[persistedData]]" as="transaction">

                    <paper-item>
                        <paper-icon-item>
                            <iron-icon icon="ing-transaction:[[_getIconId(transaction)]]"></iron-icon>
                        </paper-icon-item>
                        <paper-item-body two-line class$=" {{conditionalClassViewed(transaction.viewed)}}">
                           {{transaction.type}}{{transaction.date}}{{transaction.name}}
                            <span class="ingamount">{{transaction.amount}}</span>
                            <div secondary>{{transaction.description}}</div>
                        </paper-item-body>
                    </paper-item>

            </template>

    </template>

    <script>
        Polymer({

            is: 'off-scrum-day-app',

            properties: {
                prop1: {
                    type: String,
                    value: 'off-scrum-day-app'
                },
                persistedData: {
                    type: Array,
                    observer: '_dataChanged'
                }
            },

            mimicTransaction: function () {
                var key = Number(this.persistedData.slice(-1)[0].$key) + 1;
                this.unshift('persistedData', {
                    $key: key,
                    title: 'Fugazi'
                });
            },

            _dataChanged: function (newData, oldData) {
                if (typeof oldData !== "undefined" && newData !== oldData) {
                    console.log("data changed");
                    console.log(this.persistedData);
                }
            },

            conditionalClassViewed: function (viewed) {
                console.log(viewed);
                if ((viewed === 'true')) {
                    return 'viewed';
                } else {
                    return 'unviewed';
                }
            },

            _getIconId: function (transaction) {
                console.log('TEST', transaction);
                switch (transaction.iconId) {
                    case '1': return 'pin';
                    case '2': return "cheque";
                    case '3': return "giro";
                    case '4': return "atm";
                    case '5': return "transfer";
                    default: return '';
                }
            }
        });
    </script>
</dom-module>
